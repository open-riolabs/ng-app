<div class="container mt-2 mb-5">
  <div class="container text-center position-relative my-3">
    <h3>{{ 'core.account.title' | translate}}</h3>
    <i role="button" class="bi bi-chevron-left position-absolute start-0 top-50 translate-middle-y"
      style="font-size: 25px;font-weight: 600;" (click)="backClicked()"></i>
    <button rlb-button outline size="sm" class="position-absolute end-0 top-50 translate-middle-y"
      (click)="updateProfile()">
      <i class="bi bi-floppy"></i>
    </button>
  </div>
  <rlb-list class="settings">
    <rlb-list-item class="settings-item">
      <div class="d-flex justify-content-between">
        <div class="settings-text">
          <h6 class="mt-1">{{ 'core.account.username' | translate}}</h6>
        </div>
        <div class="settings-control">
          <rlb-input *ngIf="keyCloakUser" size="small" type="text" [(ngModel)]="keyCloakUser.username" disabled />
        </div>
      </div>
    </rlb-list-item>
    <rlb-list-item class="settings-item">
      <div class="d-flex justify-content-between">
        <div class="settings-text">
          <h6 class="mt-1">{{ 'core.account.email' | translate}}</h6>
        </div>
        <div class="settings-control">
          <rlb-input *ngIf="keyCloakUser" size="small" type="text" [(ngModel)]="keyCloakUser.email" />
          <rlb-input *ngIf="!keyCloakUser" size="small" type="text" readonly />
        </div>
      </div>
    </rlb-list-item>
    <rlb-list-item class="settings-item">
      <div class="d-flex justify-content-between">
        <div class="settings-text">
          <h6 class="mt-1">{{ 'core.account.firstName' | translate}}</h6>
        </div>
        <div class="settings-control">
          <rlb-input *ngIf="keyCloakUser" size="small" type="text" [(ngModel)]="keyCloakUser.firstName" />
          <rlb-input *ngIf="!keyCloakUser" size="small" type="text" readonly />
        </div>
      </div>
    </rlb-list-item>
    <rlb-list-item class="settings-item">
      <div class="d-flex justify-content-between">
        <div class="settings-text">
          <h6 class="mt-1">{{ 'core.account.lastName' | translate}}</h6>
        </div>
        <div class="settings-control">
          <rlb-input *ngIf="keyCloakUser" size="small" type="text" [(ngModel)]="keyCloakUser.lastName" />
          <rlb-input *ngIf="!keyCloakUser" size="small" type="text" readonly />
        </div>
      </div>
    </rlb-list-item>
    <rlb-list-item class="settings-item">
      <div class="d-flex justify-content-between">
        <div class="settings-text">
          <h6 class="mt-1">{{ 'core.account.logout' | translate}}</h6>
        </div>
        <div class="settings-control">
          <button size="sm" rlb-button (click)="logout()" class="w-100">
            <i class="bi bi-box-arrow-right"></i>
            {{ 'core.account.logout' | translate}}</button>
        </div>
      </div>
    </rlb-list-item>
  </rlb-list>
  <ng-container *ngIf="keyCloakUser">
    <div class="container text-center position-relative mt-5 mb-2">
      <h3>{{ 'core.account.credentials.title' | translate}}</h3>
    </div>
    <ng-container *ngFor="let type of keycloakCredentials">
      <div class="container position-relative my-3">
        <h6>{{ ('core.account.credentials.'+type?.type) | translate }}</h6>
        <button *ngIf="type.type === 'otp'" rlb-button size="sm"
          class="position-absolute end-0 top-50 translate-middle-y" (click)="configureOTP()">
          {{ 'core.account.credentials.addOTP' | translate}}
        </button>
      </div>
      <rlb-list class="settings mb-5">
        <rlb-list-item class="settings-item" *ngFor="let cred of type.userCredentialMetadatas">
          <div class="row">
            <div class="col-12">
              <dl class="row signed-in-device-grid">
                <div class="col-md-1">
                  <i class="bi bi-key" style="font-size: 35px;"></i>
                </div>
                <div class="col-md-5">
                  <dt>
                    <span class="text-muted">
                      {{ 'core.account.credentials.name' | translate }}
                    </span>
                  </dt>
                  <dd>{{cred.credential.userLabel || cred.credential.type}}</dd>
                </div>
                <div class="col-md-4">
                  <dt>
                    <span class="text-muted">
                      {{'core.account.credentials.created' | translate}}
                    </span>
                  </dt>
                  <dd>{{cred.credential.createdDate | date:'dd:MM:yyyy HH:mm' }}</dd>
                </div>
                <div class="col-md-2">
                  <dt><span class="text-muted">{{'core.account.credentials.actions' |
                      translate}}</span></dt>
                  <dd>
                    <button *ngIf="type.removeable" size="sm" rlb-button class="w-100" color="danger"
                      (click)="removeCredential(type.type, cred.credential.id)">
                      <i class="bi bi-trash"></i>
                      {{ 'core.account.credentials.delete' | translate}}
                    </button>
                    <button *ngIf="!type.removeable" size="sm" rlb-button class="w-100" outline
                      (click)="updatePassword()">
                      <i class="bi bi-trash"></i>
                      {{ 'core.account.credentials.update' | translate}}
                    </button>
                  </dd>
                </div>
              </dl>
            </div>
          </div>
        </rlb-list-item>
        <rlb-list-item *ngIf="type.userCredentialMetadatas.length === 0">
          <div class="d-flex justify-content-center">
            <div class="settings-text">
              <h6 class="mt-1">{{ 'core.account.credentials.noCredentials' | translate}}</h6>
            </div>
          </div>
        </rlb-list-item>
      </rlb-list>
    </ng-container>
    <div class="container text-center position-relative mt-5 mb-3">
      <h3>{{ 'core.account.session.title' | translate}}</h3>
    </div>
    <rlb-list class="settings">
      <rlb-list-item class="settings-item" *ngFor="let d of keyCloakDevices">
        <div class="row mb-2">
          <div class="col-1">
            <i class="bi bi-laptop" style="font-size: 35px;"></i>
          </div>
          <div class="col-11">
            <span class="session-title">{{d.os}} {{d.osVersion}} - {{d.browser}}</span>
            <span *ngIf="d.current" class="badge bg-success ms-3">
              <span class="badge-content">
                {{ 'core.account.session.current' | translate}}
              </span>
            </span>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <dl class="row signed-in-device-grid">
              <div class=" col-md-1">
              </div>
              <div class=" col-md-2">
                <dt><span class="text-muted">{{ 'core.account.session.ip' | translate }}</span>
                </dt>
                <dd>{{d.ipAddress}}</dd>
              </div>
              <div class="col-md-2">
                <dt>
                  <span class="text-muted">
                    {{'core.account.session.lastAccess' | translate}}
                  </span>
                </dt>
                <dd>{{d.lastAccess*1000 | date:'dd/MM/yyyy - HH:mm'}}</dd>
              </div>
              <div class="col-md-2">
                <dt><span class="text-muted">{{'core.account.session.applications' |
                    translate}}</span></dt>
                <dd>{{d.clientslist }} </dd>
              </div>
              <div class="col-md-2">
                <dt><span class="text-muted">{{'core.account.session.started' |
                    translate}}</span></dt>
                <dd>{{d.started*1000 | date:'dd/MM/yyyy - HH:mm'}}</dd>
              </div>
              <div class="col-md-2">
                <dt><span class="text-muted">{{'core.account.session.expires' |
                    translate}}</span></dt>
                <dd>{{d.expires*1000 | date:'dd/MM/yyyy - HH:mm'}}</dd>
              </div>
            </dl>
          </div>
        </div>
      </rlb-list-item>
    </rlb-list>
  </ng-container>
</div>