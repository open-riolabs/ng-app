<div class="rlb-app">
  <ng-container *ngIf="sidearVisible$ | async">
    <rlb-sidebar id="sidebar" *ngIf="env.sidebarMode !== 'none'">
      <rlb-sidebar-header *ngIf="env.sidebarMode ==='logo'" mode="logo"
        [data]="{ image:env.appLogo, text:env.appTitle }" />
      <rlb-sidebar-header *ngIf="env.sidebarMode ==='user'" mode="user" />
      <rlb-sidebar-search *ngIf="sidearHasSearch$ | async" search-title="Search"
        (on-search)="setSidearSearchText($event)"></rlb-sidebar-search>
      <rlb-sidebar-item *ngFor="let sideItem of sidebarItems" [icon]="sideItem.icon">
        {{sideItem.label}}
      </rlb-sidebar-item>
      <rlb-sidebar-footer>
        <rlb-sidebar-item *ngFor="let sideItem of sidebarFooterItems" [icon]="sideItem.icon">
          {{sideItem.label}}
        </rlb-sidebar-item>
        <rlb-sidebar-item (action)="modalAppDialog()" icon="bi bi-grid-3x3-gap-fill">
          {{'core.apps' | translate}}
        </rlb-sidebar-item>
        <rlb-sidebar-item *ngIf="env.sidebarMode !== 'user' && (sidearHasLogin$ | async) && !(isAuth$ | async)"
          icon="bi bi-person" (action)="login()">
          {{'core.user' | translate}}
        </rlb-sidebar-item>
        <rlb-sidebar-item *ngIf="env.sidebarMode !== 'user' && (sidearHasLogin$ | async) && (isAuth$ | async)"
          icon="bi bi-person" (action)="logout()">
          {{'core.user' | translate}}
        </rlb-sidebar-item>
        <rlb-sidebar-item *ngIf="sidearHasSettings$ | async" icon="bi bi-gear">
          {{'core.settings' | translate}}
        </rlb-sidebar-item>
      </rlb-sidebar-footer>
    </rlb-sidebar>
  </ng-container>
  <div class="rlb-right-panel">
    <ng-container *ngIf="navVisible$ | async">
      <rlb-navbar color="light" expand="lg" *ngIf="env.navbarDisabled !== true">
        <a *ngIf="sidearVisible$ | async" class="d-block d-sm-none" rlb-button href="#" toggle="collapse"
          toggle-target="sidebar" [outline]="true">
          <span class="navbar-toggler-icon"></span>
        </a>
        <a *ngIf="navHeader$ | async" rlb-navbar-brand href="#">{{ navHeader$ | async }}</a>
        <rlb-navbar-form *ngIf="navSearchVisible$ | async">
          <rlb-input class="mx-2" type="search" placeholder="Search" [(ngModel)]="navSearchText"
            (keyup.enter)="setNavbarSearchText(navSearchText)">
            <button rlb-button outline after class="me-2" type="submit" (click)="setNavbarSearchText(navSearchText)">
              <i class="bi bi-search"></i>
            </button>
          </rlb-input>
        </rlb-navbar-form>
        <rlb-navbar-items>
          <ng-container ngProjectAs="rlb-navbar-item" *ngFor="let navComponent of navLeftItems$ | async">
            <ng-container *ngComponentOutlet="navComponent | leftComponent"></ng-container>
          </ng-container>
        </rlb-navbar-items>
        <rlb-navbar-items class="ms-auto">
          <ng-container ngProjectAs="rlb-navbar-item" *ngFor="let navComponent of navRightItems$ | async">
            <ng-container *ngComponentOutlet="navComponent | rightComponent"></ng-container>
          </ng-container>
          <rlb-navbar-separator />
          <rlb-navbar-item href="#" *ngIf="(navLoginVisible$ | async) && (isAuth$ | async)" dropdown>
            <i class="bi bi-person"></i>
            <span class="ms-2 me-1">{{ (user$|async).name}}</span>
            <ul rlb-dropdown-menu placement="right">
              <li rlb-dropdown-item (click)="logout()">{{'core.logout' | translate}}</li>
            </ul>
          </rlb-navbar-item>
          <rlb-navbar-item href="#" *ngIf="(navLoginVisible$|async) && !(isAuth$ | async)" (click)="login()">
            <i class="bi bi-person"></i>
          </rlb-navbar-item>
          <rlb-navbar-item href="#" *ngIf="navSettingsVisible$ | async">
            <i class="bi bi-gear"></i>
          </rlb-navbar-item>
        </rlb-navbar-items>
      </rlb-navbar>
    </ng-container>
    <div class="rlb-content">
      <ng-content></ng-content>
    </div>
  </div>
</div>

<ng-container *ngIf="modalContainerId">
  <rlb-modal-container [id]="modalContainerId" />
</ng-container>

<ng-container *ngIf="toastContainerIds">
  <ng-container *ngIf="toastContainerIds.constructor.name === 'Array'; else toastContainerIdsIsNotArray">
    <rlb-toast-container *ngFor="let toastContainerId of toastContainerIds | asMulti" [id]="toastContainerId" />
  </ng-container>
  <ng-template #toastContainerIdsIsNotArray>
    <rlb-toast-container class="position-fixed bottom-0 end-0 p-3" [id]="toastContainerIds | asSingle" />
  </ng-template>
</ng-container>
